<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Data Wrangling with dplyr | Computational Toolkit for Educational Scientists" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Computational tools useful for researchers in the education sciences." />
<meta name="github-repo" content="zief0002/modeling" />

<meta name="author" content="Andrew Zieffler" />

<meta name="date" content="2020-08-13" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Computational tools useful for researchers in the education sciences.">

<title>Data Wrangling with dplyr | Computational Toolkit for Educational Scientists</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style/style.css" type="text/css" />
<link rel="stylesheet" href="style/table-styles.css" type="text/css" />
<link rel="stylesheet" href="style/syntax.css" type="text/css" />
<link rel="stylesheet" href="style/navbar.css" type="text/css" />
<link rel="stylesheet" href="style/notes.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#foreword">Foreword</a></li>
<li><a href="statistical-computation.html#statistical-computation">Statistical Computation</a></li>
<li><a href="r-and-rstudio-installation-and-setup.html#r-and-rstudio-installation-and-setup">R and RStudio: Installation and Setup</a></li>
<li><a href="getting-started-with-r.html#getting-started-with-r">Getting Started with R</a></li>
<li><a href="data-structures-in-r.html#data-structures-in-r">Data Structures in R</a></li>
<li><a href="data-wrangling-with-dplyr.html#data-wrangling-with-dplyr">Data Wrangling with dplyr</a></li>
<li><a href="references.html#references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="data-wrangling-with-dplyr" class="section level1">
<h1>Data Wrangling with dplyr</h1>
<p>In this chapter, you will be learn about how to use functionality from the <strong>dplyr</strong> package to wrangle your data. Data wrangling is the catchall phrase that includes the processes of cleaning, structuring, and summarizing your data. It is a skill that every educational scientist needs to have in their computational toolkit!</p>
<p>We will use the <a href="https://raw.githubusercontent.com/zief0002/modeling/master/data/riverview.csv">riverview.csv</a> data to illustrate several data wrangling ideas. The data contain five attributes collected from a random sample of <span class="math inline">\(n=32\)</span> employees working for the city of Riverview, a hypothetical midwestern city (see the <a href="http://zief0002.github.io/epsy-8251/codebooks/riverview.html">data codebook</a>). To begin, we will load several libraries and import the data into an object called <code>city</code>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-wrangling-with-dplyr.html#cb91-1"></a><span class="co"># Load libraries</span></span>
<span id="cb91-2"><a href="data-wrangling-with-dplyr.html#cb91-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb91-3"><a href="data-wrangling-with-dplyr.html#cb91-3"></a><span class="kw">library</span>(readr)</span>
<span id="cb91-4"><a href="data-wrangling-with-dplyr.html#cb91-4"></a></span>
<span id="cb91-5"><a href="data-wrangling-with-dplyr.html#cb91-5"></a><span class="co"># Read in data</span></span>
<span id="cb91-6"><a href="data-wrangling-with-dplyr.html#cb91-6"></a>city =<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://raw.githubusercontent.com/zief0002/modeling/master/data/riverview.csv&quot;</span>)</span>
<span id="cb91-7"><a href="data-wrangling-with-dplyr.html#cb91-7"></a><span class="kw">head</span>(city)</span></code></pre></div>
<pre><code># A tibble: 6 x 5
  education income seniority gender     party      
      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      
1         8   26.4         9 female     Independent
2         8   37.4         7 Not female Democrat   
3        10   34.2        16 female     Independent
4        10   25.5         1 female     Republican 
5        10   47.0        14 Not female Democrat   
6        12   46.5        11 female     Democrat   </code></pre>
<p><br /><br /></p>
<div id="piping-the-key-to-using-dplyr" class="section level2">
<h2>Piping: The Key to Using dplyr</h2>
<p>Recall that functions work by taking arguments as inputs and then producing an output. For example, the <code>summary()</code> function takes the <code>city</code> data frame as its input.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data-wrangling-with-dplyr.html#cb93-1"></a><span class="kw">summary</span>(city)</span></code></pre></div>
<pre><code>   education      income        seniority        gender         
 Min.   : 8   Min.   :25.48   Min.   : 1.00   Length:32         
 1st Qu.:12   1st Qu.:44.51   1st Qu.: 9.75   Class :character  
 Median :16   Median :55.83   Median :15.00   Mode  :character  
 Mean   :16   Mean   :53.74   Mean   :14.81                     
 3rd Qu.:20   3rd Qu.:62.72   3rd Qu.:20.25                     
 Max.   :24   Max.   :82.73   Max.   :27.00                     
    party          
 Length:32         
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
<p>We could get the same result by using the piping operator (<code>%&gt;%</code>). This operator takes a DATA FRAME (given immediately before the operator) and uses it as the FIRST argument in the function that comes immediately after the operator.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="data-wrangling-with-dplyr.html#cb95-1"></a><span class="co"># The pipe operator makes city the first argument of the summary function</span></span>
<span id="cb95-2"><a href="data-wrangling-with-dplyr.html#cb95-2"></a>city <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>   education      income        seniority        gender         
 Min.   : 8   Min.   :25.48   Min.   : 1.00   Length:32         
 1st Qu.:12   1st Qu.:44.51   1st Qu.: 9.75   Class :character  
 Median :16   Median :55.83   Median :15.00   Mode  :character  
 Mean   :16   Mean   :53.74   Mean   :14.81                     
 3rd Qu.:20   3rd Qu.:62.72   3rd Qu.:20.25                     
 Max.   :24   Max.   :82.73   Max.   :27.00                     
    party          
 Length:32         
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
<p>Note since the <code>summary()</code> function did NOT include any additional arguments, we do not include anything between the parentheses after we pipe. Here is another example that illustrate the use of the pipe operator.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data-wrangling-with-dplyr.html#cb97-1"></a><span class="co"># Count number of rows in city data frame</span></span>
<span id="cb97-2"><a href="data-wrangling-with-dplyr.html#cb97-2"></a><span class="kw">nrow</span>(city)</span></code></pre></div>
<pre><code>[1] 32</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="data-wrangling-with-dplyr.html#cb99-1"></a><span class="co"># Can be written using the pipe operator as...</span></span>
<span id="cb99-2"><a href="data-wrangling-with-dplyr.html#cb99-2"></a>city <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>[1] 32</code></pre>
<p>The <code>filter()</code> function from the <strong>dplyr</strong> package is used to select certain rows from a data frame. For example, the syntax below selects all rows from the <code>city</code> data frame that have a <code>gender</code> value of <code>female</code>. To do this we provide a logical statement as the second argument to the <code>filter()</code> function.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="data-wrangling-with-dplyr.html#cb101-1"></a><span class="co"># Select the rows from city that have a gender value of &quot;female&quot; </span></span>
<span id="cb101-2"><a href="data-wrangling-with-dplyr.html#cb101-2"></a><span class="kw">filter</span>(city, gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 18 x 5
   education income seniority gender party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      
 1         8   26.4         9 female Independent
 2        10   34.2        16 female Independent
 3        10   25.5         1 female Republican 
 4        12   46.5        11 female Democrat   
 5        12   52.5        16 female Independent
 6        14   32.6         5 female Independent
 7        15   37.3         8 female Democrat   
 8        16   38.6        11 female Independent
 9        16   55.9        22 female Independent
10        16   59.5        20 female Independent
11        17   60.1        10 female Independent
12        18   54.8        20 female Republican 
13        18   62.5        16 female Republican 
14        19   56.0        21 female Independent
15        20   56.3        22 female Independent
16        20   54.7        12 female Independent
17        21   71.2        26 female Democrat   
18        22   56.3         8 female Independent</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="data-wrangling-with-dplyr.html#cb103-1"></a><span class="co"># Can be written using the pipe operator as...</span></span>
<span id="cb103-2"><a href="data-wrangling-with-dplyr.html#cb103-2"></a>city <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 18 x 5
   education income seniority gender party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      
 1         8   26.4         9 female Independent
 2        10   34.2        16 female Independent
 3        10   25.5         1 female Republican 
 4        12   46.5        11 female Democrat   
 5        12   52.5        16 female Independent
 6        14   32.6         5 female Independent
 7        15   37.3         8 female Democrat   
 8        16   38.6        11 female Independent
 9        16   55.9        22 female Independent
10        16   59.5        20 female Independent
11        17   60.1        10 female Independent
12        18   54.8        20 female Republican 
13        18   62.5        16 female Republican 
14        19   56.0        21 female Independent
15        20   56.3        22 female Independent
16        20   54.7        12 female Independent
17        21   71.2        26 female Democrat   
18        22   56.3         8 female Independent</code></pre>
<p>Here, since the <code>filter()</code> function included a second argument, we include that argument in the function that the data frame is piped into. What is piped into the function, in this case <code>city</code>, will be automatically inputted into the FIRST argument.</p>
<p><br /><br /></p>
</div>
<div id="common-dplyr-functions-for-data-wrangling" class="section level2">
<h2>Common dplyr Functions for Data Wrangling</h2>
<p>Here are some common operations that researchers use to prepare data for analysis (i.e., data preparation, data wrangling, data cleaning) and the corresponding <strong>dplyr</strong> functions.</p>
<table style="width:60%; margin-left: auto; margin-right: auto;" class="table">
<caption>
<span id="tab:unnamed-chunk-7">Table 1: </span>Common data wrangling activities and the corresponding <strong>dplyr</strong> function.
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Data wrangling activity
</th>
<th style="text-align:left;text-align: center;">
dplyr function
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Select a subset of rows from a data frame.
</td>
<td style="text-align:left;">
<code>filter()</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Select a subset of columns from a data frame.
</td>
<td style="text-align:left;">
<code>select()</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Add new columns to a data frame.
</td>
<td style="text-align:left;">
<code>mutate()</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Sort and re-order data in a data frame.
</td>
<td style="text-align:left;">
<code>arrange()</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Compute summaries of columns in a data frame.
</td>
<td style="text-align:left;">
<code>summarize()</code>
</td>
</tr>
<tr>
<td style="text-align:left;">
Group the data to carry out computations for each group.
</td>
<td style="text-align:left;">
<code>group_by()</code>
</td>
</tr>
</tbody>
</table>
<p><br /><br /></p>
</div>
<div id="select-a-subset-of-rows-filtering" class="section level2">
<h2>Select a Subset of Rows: Filtering</h2>
<p>To select a subset of rows, we will pipe the data frame we want to select rows from into the <code>filter()</code> function. The argument(s) for this function are logical expressions that will be used to select the rows.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data-wrangling-with-dplyr.html#cb105-1"></a><span class="co"># Select the female employees</span></span>
<span id="cb105-2"><a href="data-wrangling-with-dplyr.html#cb105-2"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb105-3"><a href="data-wrangling-with-dplyr.html#cb105-3"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>)</span></code></pre></div>
<pre><code># A tibble: 18 x 5
   education income seniority gender party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      
 1         8   26.4         9 female Independent
 2        10   34.2        16 female Independent
 3        10   25.5         1 female Republican 
 4        12   46.5        11 female Democrat   
 5        12   52.5        16 female Independent
 6        14   32.6         5 female Independent
 7        15   37.3         8 female Democrat   
 8        16   38.6        11 female Independent
 9        16   55.9        22 female Independent
10        16   59.5        20 female Independent
11        17   60.1        10 female Independent
12        18   54.8        20 female Republican 
13        18   62.5        16 female Republican 
14        19   56.0        21 female Independent
15        20   56.3        22 female Independent
16        20   54.7        12 female Independent
17        21   71.2        26 female Democrat   
18        22   56.3         8 female Independent</code></pre>
<p>Here we are selecting only the rows where the gender variable is equal to (<code>==</code>) the character string “female”. Recall that a single equals sign (<code>=</code>) is the assignment operator and that to say “is equal to”, we need to use two equals signs (<code>==</code>).</p>
<div class="protip">
<p>It is a good coding practice to use multiple lines when you are piping rather than putting all the syntax on a single line. When you do this, the pipe operator (<code>%&gt;%</code>) needs to come at the end of the line. For example, in the code above, the pip operator is at the end of the first line of syntax rather than at the beginning of the second line of syntax. Include a line break after every pipe operator you use.</p>
</div>
<p>Note that the output from this computation (the rows of female employees) is only printed to the screen. If you want to keep the filtered data or operate on it further, you need to assign the output into an object.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="data-wrangling-with-dplyr.html#cb107-1"></a><span class="co"># Filter the female employees</span></span>
<span id="cb107-2"><a href="data-wrangling-with-dplyr.html#cb107-2"></a>female_employees =<span class="st"> </span>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb107-3"><a href="data-wrangling-with-dplyr.html#cb107-3"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>)</span>
<span id="cb107-4"><a href="data-wrangling-with-dplyr.html#cb107-4"></a></span>
<span id="cb107-5"><a href="data-wrangling-with-dplyr.html#cb107-5"></a><span class="co"># Count the number of rows (females)</span></span>
<span id="cb107-6"><a href="data-wrangling-with-dplyr.html#cb107-6"></a><span class="kw">nrow</span>(female_employees)</span></code></pre></div>
<pre><code>[1] 18</code></pre>
<p>We could have found the same result exclusively using piping; without the interim assignment.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="data-wrangling-with-dplyr.html#cb109-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-2"><a href="data-wrangling-with-dplyr.html#cb109-2"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb109-3"><a href="data-wrangling-with-dplyr.html#cb109-3"></a><span class="st">  </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>[1] 18</code></pre>
<p>The first pipe operator uses the <code>city</code> data frame in the <code>filter()</code> function to select the female employees. This output (only the female employees) is then used in the <code>nrow()</code> function to count the number of rows. At is akin to a constant pipeline of chaining functions together; the output of a computation is used as the input into the next computation in the pipeline.</p>
<p>Here we use <code>filter()</code> to select the employees that have less than a high school level of education and then summarize all of the columns using the <code>summary()</code> function.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="data-wrangling-with-dplyr.html#cb111-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-2"><a href="data-wrangling-with-dplyr.html#cb111-2"></a><span class="st">  </span><span class="kw">filter</span>(education <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></span>
<span id="cb111-3"><a href="data-wrangling-with-dplyr.html#cb111-3"></a><span class="st">  </span><span class="kw">summary</span>()</span></code></pre></div>
<pre><code>   education        income        seniority       gender         
 Min.   : 8.0   Min.   :25.48   Min.   : 1.0   Length:5          
 1st Qu.: 8.0   1st Qu.:26.43   1st Qu.: 7.0   Class :character  
 Median :10.0   Median :34.18   Median : 9.0   Mode  :character  
 Mean   : 9.2   Mean   :34.11   Mean   : 9.4                     
 3rd Qu.:10.0   3rd Qu.:37.45   3rd Qu.:14.0                     
 Max.   :10.0   Max.   :47.03   Max.   :16.0                     
    party          
 Length:5          
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
<p><br /><br /></p>
<div id="filtering-on-multiple-attributes" class="section level3">
<h3>Filtering on Multiple Attributes</h3>
<p>You can filter on multiple attributes by including more than one logical statement in the <code>filter()</code> function. For example, the syntax below counts the number of female employees with less than a high school level of education.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="data-wrangling-with-dplyr.html#cb113-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb113-2"><a href="data-wrangling-with-dplyr.html#cb113-2"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>, education <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></span>
<span id="cb113-3"><a href="data-wrangling-with-dplyr.html#cb113-3"></a><span class="st">  </span><span class="kw">nrow</span>()</span></code></pre></div>
<pre><code>[1] 3</code></pre>
<p>Here, when we included multiple logical expressions in the <code>filter()</code> function, separated by a comma, they were linked using the AND (<code>&amp;</code>) operator. This means that both expressions have to evaluate as <code>TRUE</code> to be included. We could also have explicitly used the <code>&amp;</code> operator to link the two statements.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="data-wrangling-with-dplyr.html#cb115-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-2"><a href="data-wrangling-with-dplyr.html#cb115-2"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>, education <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>)</span>
<span id="cb115-3"><a href="data-wrangling-with-dplyr.html#cb115-3"></a></span>
<span id="cb115-4"><a href="data-wrangling-with-dplyr.html#cb115-4"></a><span class="co"># Is equivalent to...</span></span>
<span id="cb115-5"><a href="data-wrangling-with-dplyr.html#cb115-5"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-6"><a href="data-wrangling-with-dplyr.html#cb115-6"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span> <span class="op">&amp;</span><span class="st"> </span>education <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>)</span></code></pre></div>
<p>We can also <code>filter()</code> using the OR (<code>|</code>) operator. This means that if EITHER expression evaluates as TRUE it is included.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="data-wrangling-with-dplyr.html#cb116-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb116-2"><a href="data-wrangling-with-dplyr.html#cb116-2"></a><span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;female&quot;</span> <span class="op">|</span><span class="st"> </span>education <span class="op">&lt;</span><span class="st"> </span><span class="dv">12</span>)</span></code></pre></div>
<pre><code># A tibble: 20 x 5
   education income seniority gender     party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      
 1         8   26.4         9 female     Independent
 2         8   37.4         7 Not female Democrat   
 3        10   34.2        16 female     Independent
 4        10   25.5         1 female     Republican 
 5        10   47.0        14 Not female Democrat   
 6        12   46.5        11 female     Democrat   
 7        12   52.5        16 female     Independent
 8        14   32.6         5 female     Independent
 9        15   37.3         8 female     Democrat   
10        16   38.6        11 female     Independent
11        16   55.9        22 female     Independent
12        16   59.5        20 female     Independent
13        17   60.1        10 female     Independent
14        18   54.8        20 female     Republican 
15        18   62.5        16 female     Republican 
16        19   56.0        21 female     Independent
17        20   56.3        22 female     Independent
18        20   54.7        12 female     Independent
19        21   71.2        26 female     Democrat   
20        22   56.3         8 female     Independent</code></pre>
<p>This syntax would select any employee that is either female OR has an education less than 12 years.</p>
<p><br /><br /></p>
</div>
</div>
<div id="selecting-a-subset-and-renaming-columns" class="section level2">
<h2>Selecting a Subset and Renaming Columns</h2>
<p>To select a subset of columns, we will use the <code>select()</code> function. The argument(s) for this function are the column names of the data frame that you want to select. For example, to select the <code>education</code>, <code>income</code>, and <code>gender</code> columns from the <code>city</code> data frame we would use the following syntax:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="data-wrangling-with-dplyr.html#cb118-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb118-2"><a href="data-wrangling-with-dplyr.html#cb118-2"></a><span class="st">  </span><span class="kw">select</span>(education, income, gender)</span></code></pre></div>
<pre><code># A tibble: 32 x 3
   education income gender    
       &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
 1         8   26.4 female    
 2         8   37.4 Not female
 3        10   34.2 female    
 4        10   25.5 female    
 5        10   47.0 Not female
 6        12   46.5 female    
 7        12   52.5 female    
 8        12   37.7 Not female
 9        12   50.3 Not female
10        14   32.6 female    
# … with 22 more rows</code></pre>
<p>There are a number of helper functions you can use within the <code>select()</code> function. For example, <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code>. These let you quickly match larger blocks of columns that meet some criterion. The syntax below selects all the columns that have a column name that ends in ‘e’.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="data-wrangling-with-dplyr.html#cb120-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-2"><a href="data-wrangling-with-dplyr.html#cb120-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;e&quot;</span>))</span></code></pre></div>
<pre><code># A tibble: 32 x 1
   income
    &lt;dbl&gt;
 1   26.4
 2   37.4
 3   34.2
 4   25.5
 5   47.0
 6   46.5
 7   52.5
 8   37.7
 9   50.3
10   32.6
# … with 22 more rows</code></pre>
<p><br /><br /></p>
<div id="renaming-columns" class="section level3">
<h3>Renaming Columns</h3>
<p>You can rename a column by using the <code>rename()</code> function. Here we select the <code>education</code>, <code>income</code>, and <code>gender</code> columns from the <code>city</code> data frame and then rename the <code>education</code> column to <code>educ</code>. Note that this works similar to assignment in that the new column name is to the left of the equal sign.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="data-wrangling-with-dplyr.html#cb122-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb122-2"><a href="data-wrangling-with-dplyr.html#cb122-2"></a><span class="st">  </span><span class="kw">select</span>(education, income, gender) <span class="op">%&gt;%</span></span>
<span id="cb122-3"><a href="data-wrangling-with-dplyr.html#cb122-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">educ =</span> education)</span></code></pre></div>
<pre><code># A tibble: 32 x 3
    educ income gender    
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
 1     8   26.4 female    
 2     8   37.4 Not female
 3    10   34.2 female    
 4    10   25.5 female    
 5    10   47.0 Not female
 6    12   46.5 female    
 7    12   52.5 female    
 8    12   37.7 Not female
 9    12   50.3 Not female
10    14   32.6 female    
# … with 22 more rows</code></pre>
<p><br /><br /></p>
</div>
</div>
<div id="create-new-columns-mutating" class="section level2">
<h2>Create New Columns: Mutating</h2>
<p>To create new columns, we will use the <code>mutate()</code> function. Here we create a new column called <code>income2</code> based on multiplying the original <code>income</code> column by 1000.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="data-wrangling-with-dplyr.html#cb124-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb124-2"><a href="data-wrangling-with-dplyr.html#cb124-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb124-3"><a href="data-wrangling-with-dplyr.html#cb124-3"></a>    <span class="dt">income2 =</span> income <span class="op">*</span><span class="st"> </span><span class="dv">1000</span></span>
<span id="cb124-4"><a href="data-wrangling-with-dplyr.html#cb124-4"></a>    )</span></code></pre></div>
<pre><code># A tibble: 32 x 6
   education income seniority gender     party       income2
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;
 1         8   26.4         9 female     Independent   26430
 2         8   37.4         7 Not female Democrat      37449
 3        10   34.2        16 female     Independent   34182
 4        10   25.5         1 female     Republican    25479
 5        10   47.0        14 Not female Democrat      47034
 6        12   46.5        11 female     Democrat      46488
 7        12   52.5        16 female     Independent   52480
 8        12   37.7        14 Not female Democrat      37656
 9        12   50.3        24 Not female Democrat      50265
10        14   32.6         5 female     Independent   32631
# … with 22 more rows</code></pre>
<p>Depending on your print options, the results in <code>income2</code> may be in scientific notation. For example <code>3.74e+04</code> is equivalent to <span class="math inline">\(3.74 \times 10^4=37400\)</span>.</p>
<div class="protip">
<p>You can “turn off” scientific notation by running the following syntax in your R session:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-wrangling-with-dplyr.html#cb126-1"></a><span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">99</span>)</span></code></pre></div>
<p>You will need to run this syntax every R session.</p>
</div>
<p>You can create multiple new columns within the same <code>mutate()</code> function. Simply include each new column as an argument. Below we again create <code>income2</code>, but we also additionally create <code>cent_educ</code> which computes the difference between each employee’s education level and the mean education level.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="data-wrangling-with-dplyr.html#cb127-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-2"><a href="data-wrangling-with-dplyr.html#cb127-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb127-3"><a href="data-wrangling-with-dplyr.html#cb127-3"></a>    <span class="dt">income2 =</span> income <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>,</span>
<span id="cb127-4"><a href="data-wrangling-with-dplyr.html#cb127-4"></a>    <span class="dt">cent_educ =</span> education <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(education)</span>
<span id="cb127-5"><a href="data-wrangling-with-dplyr.html#cb127-5"></a>    )</span></code></pre></div>
<pre><code># A tibble: 32 x 7
   education income seniority gender     party       income2 cent_educ
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
 1         8   26.4         9 female     Independent   26430        -8
 2         8   37.4         7 Not female Democrat      37449        -8
 3        10   34.2        16 female     Independent   34182        -6
 4        10   25.5         1 female     Republican    25479        -6
 5        10   47.0        14 Not female Democrat      47034        -6
 6        12   46.5        11 female     Democrat      46488        -4
 7        12   52.5        16 female     Independent   52480        -4
 8        12   37.7        14 Not female Democrat      37656        -4
 9        12   50.3        24 Not female Democrat      50265        -4
10        14   32.6         5 female     Independent   32631        -2
# … with 22 more rows</code></pre>
<p><br /><br /></p>
</div>
<div id="sorting-the-data-arranging" class="section level2">
<h2>Sorting the Data: Arranging</h2>
<p>The <code>arrange()</code> function sorts the data based on the values within one or more specified columns. The data is ordered based on the column name provided in the argument(s). The syntax below sorts the rows in the <code>city</code> data frame from smallest to largest income.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="data-wrangling-with-dplyr.html#cb129-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="data-wrangling-with-dplyr.html#cb129-2"></a><span class="st">  </span><span class="kw">arrange</span>(income)</span></code></pre></div>
<pre><code># A tibble: 32 x 5
   education income seniority gender     party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      
 1        10   25.5         1 female     Republican 
 2         8   26.4         9 female     Independent
 3        14   32.6         5 female     Independent
 4        10   34.2        16 female     Independent
 5        15   37.3         8 female     Democrat   
 6         8   37.4         7 Not female Democrat   
 7        12   37.7        14 Not female Democrat   
 8        16   38.6        11 female     Independent
 9        12   46.5        11 female     Democrat   
10        10   47.0        14 Not female Democrat   
# … with 22 more rows</code></pre>
<p>Providing the <code>arrange()</code> function multiple arguments sort initially by the column name given in first argument, and then by the columns given in subsequent arguments. Here the data are sorted first by gender (alphabetically since <code>gender</code> is a character string) and then by income (lowest to highest).</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="data-wrangling-with-dplyr.html#cb131-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-2"><a href="data-wrangling-with-dplyr.html#cb131-2"></a><span class="st">  </span><span class="kw">arrange</span>(gender, income)</span></code></pre></div>
<pre><code># A tibble: 32 x 5
   education income seniority gender party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      
 1        10   25.5         1 female Republican 
 2         8   26.4         9 female Independent
 3        14   32.6         5 female Independent
 4        10   34.2        16 female Independent
 5        15   37.3         8 female Democrat   
 6        16   38.6        11 female Independent
 7        12   46.5        11 female Democrat   
 8        12   52.5        16 female Independent
 9        20   54.7        12 female Independent
10        18   54.8        20 female Republican 
# … with 22 more rows</code></pre>
<p>Use the <code>desc()</code> function on a column name to sort the data in descending order. Here the data are sorted first by gender (alphabetically since <code>gender</code> is a character string) and then by income. Here the data are sorted first by gender (alphabetically) and then by income (highest to lowest).</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="data-wrangling-with-dplyr.html#cb133-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="data-wrangling-with-dplyr.html#cb133-2"></a><span class="st">  </span><span class="kw">arrange</span>(gender, <span class="kw">desc</span>(income))</span></code></pre></div>
<pre><code># A tibble: 32 x 5
   education income seniority gender party      
       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      
 1        21   71.2        26 female Democrat   
 2        18   62.5        16 female Republican 
 3        17   60.1        10 female Independent
 4        16   59.5        20 female Independent
 5        20   56.3        22 female Independent
 6        22   56.3         8 female Independent
 7        19   56.0        21 female Independent
 8        16   55.9        22 female Independent
 9        18   54.8        20 female Republican 
10        20   54.7        12 female Independent
# … with 22 more rows</code></pre>
<p><br /><br /></p>
</div>
<div id="computing-summaries-of-data-in-a-column" class="section level2">
<h2>Computing Summaries of Data in a Column</h2>
<p>The <code>summarize()</code> function is used to compute summaries of data in a given column. Here we compute the mean income for all the employees.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="data-wrangling-with-dplyr.html#cb135-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-2"><a href="data-wrangling-with-dplyr.html#cb135-2"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb135-3"><a href="data-wrangling-with-dplyr.html#cb135-3"></a>    <span class="dt">M =</span> <span class="kw">mean</span>(income)</span>
<span id="cb135-4"><a href="data-wrangling-with-dplyr.html#cb135-4"></a>    )</span></code></pre></div>
<pre><code># A tibble: 1 x 1
      M
  &lt;dbl&gt;
1  53.7</code></pre>
<p>The output from <code>summarize()</code> is a data frame with a single row and one or more columns, depending on how many summaries you computed. Here we computed a single summary so there is only one column. We also named the column <code>M</code> within the <code>summarize()</code> function.</p>
<p>Multiple summaries can be computed by providing more than one argument to the <code>summarize()</code> function. The output is still a single row data frame, but now there will be multiple columns, one for each summary computation. Here we compute the mean income for all the employees and the standard deviation of the incomes.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="data-wrangling-with-dplyr.html#cb137-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-2"><a href="data-wrangling-with-dplyr.html#cb137-2"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb137-3"><a href="data-wrangling-with-dplyr.html#cb137-3"></a>    <span class="dt">M  =</span> <span class="kw">mean</span>(income),</span>
<span id="cb137-4"><a href="data-wrangling-with-dplyr.html#cb137-4"></a>    <span class="dt">SD =</span> <span class="kw">sd</span>(income)</span>
<span id="cb137-5"><a href="data-wrangling-with-dplyr.html#cb137-5"></a>    )</span></code></pre></div>
<pre><code># A tibble: 1 x 2
      M    SD
  &lt;dbl&gt; &lt;dbl&gt;
1  53.7  14.6</code></pre>
<p><br /><br /></p>
</div>
<div id="computations-on-groups" class="section level2">
<h2>Computations on Groups</h2>
<p>The <code>group_by()</code> function groups the data by a specified variable. By itself, this function essentially does nothing. But it is powerful when the grouped output is piped to other functions, such as <code>summarize()</code>. Here we use <code>group_by(gender)</code> to compute the mean income and the standard deviation of the incomes for both males and females.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="data-wrangling-with-dplyr.html#cb139-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb139-2"><a href="data-wrangling-with-dplyr.html#cb139-2"></a><span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span></span>
<span id="cb139-3"><a href="data-wrangling-with-dplyr.html#cb139-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb139-4"><a href="data-wrangling-with-dplyr.html#cb139-4"></a>    <span class="dt">M  =</span> <span class="kw">mean</span>(income),</span>
<span id="cb139-5"><a href="data-wrangling-with-dplyr.html#cb139-5"></a>    <span class="dt">SD =</span> <span class="kw">sd</span>(income)</span>
<span id="cb139-6"><a href="data-wrangling-with-dplyr.html#cb139-6"></a>    )</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  gender         M    SD
  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 female      48.9  13.3
2 Not female  59.9  14.2</code></pre>
<p>You can also use <code>group_by()</code> with multiple attributes. Simply add additional column names in the <code>group_by()</code> function to create more conditional groups. For example to compute the mean income and standard deviation for males and females conditioned on political party, we can use the following syntax.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="data-wrangling-with-dplyr.html#cb141-1"></a>city <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-2"><a href="data-wrangling-with-dplyr.html#cb141-2"></a><span class="st">  </span><span class="kw">group_by</span>(gender, party) <span class="op">%&gt;%</span></span>
<span id="cb141-3"><a href="data-wrangling-with-dplyr.html#cb141-3"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb141-4"><a href="data-wrangling-with-dplyr.html#cb141-4"></a>    <span class="dt">M  =</span> <span class="kw">mean</span>(income),</span>
<span id="cb141-5"><a href="data-wrangling-with-dplyr.html#cb141-5"></a>    <span class="dt">SD =</span> <span class="kw">sd</span>(income)</span>
<span id="cb141-6"><a href="data-wrangling-with-dplyr.html#cb141-6"></a>    )</span></code></pre></div>
<pre><code># A tibble: 6 x 4
# Groups:   gender [2]
  gender     party           M    SD
  &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 female     Democrat     51.7 17.5 
2 female     Independent  48.6 12.0 
3 female     Republican   47.6 19.5 
4 Not female Democrat     53.0 14.9 
5 Not female Independent  61.6 10.4 
6 Not female Republican   70.8  9.41</code></pre>
<p>This produces the summary measures for each of the combinations of the levels of gender and political affiliation in the data.</p>
<p><br /><br /></p>
<!-- ```{r echo=FALSE, out.width="60%", fig.cap="LEFT: A visual mnemonic for a vector is a single-column bookcase. RIGHT: A visual mnemonic for a data frame is a multi-column bookcase."} -->
<!-- knitr::include_graphics("figs/15-vector-df.png") -->
<!-- ``` -->

</div>
</div>
<p style="text-align: center;">
<a href="data-structures-in-r.html"><button class="btn btn-default">Previous</button></a>
<a href="references.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
